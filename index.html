<!DOCTYPE html>
<html lang="es" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Beerland sistema de puntos</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
      body {color: white; background-color: black;}
      .botones3 {
        width: 33%;
        height: 100%;
      }
      .botones2 {
        width: 49%;
        height: 100%;
      }
      .botonesfront {
        position: absolute;
        width: 100%;
        height: 10%;
        bottom: 2%
      }
      .botonescli {
        position: absolute;
        width: 100%;
        height: 20%;
        bottom: 1%
      }
      .front {
        position: fixed;
        opacity: 100%;
      	left: 0px;
      	top: 0px;
      	width: 100%;
      	height: 100%;
        z-index: 999
        background-color: #000000
      }
      .cliente {
        position: fixed;
        opacity: 0%;
      	left: 0px;
      	top: 0px;
      	width: 100%;
      	height: 100%;
        z-index: 998
        background-color: #0D0000
      }
      .contenedor {
        position: fixed;
        opacity: 100%;
      	left: 33%;
      	top: 10%;
      	width: 35%;
      	height: 50%;
        z-index: 999;
        background-color: #000000
      }
    </style>
  </head>
  <body id='body'>
    <div class="cliente" id="cliente">
      <div class="botonescli">
        <input class="botones3" type="button" id="cargar" value="Cargar puntos">
        <input class="botones3" type="button" id="usar" value="Usar puntos">
        <input class="botones3" type="button" id="eliminarthis" value="Eliminar este cliente">
      </div>
      <div class="contenedor" id="contenedor">
        <table style="width:100%; margin: 0px">
          <tr>
            <th>Documento: </th>
            <td id="documento"></td>
          </tr>
          <tr>
            <th>ID tarjeta: </th>
            <td id="tarjeta"></td>
          </tr>
          <tr>
            <th>Nacimiento: </th>
            <td id="nacimiento"></td>
          </tr>
          <tr>
            <th>Puntos disponibles: </th>
            <td id="puntos"></td>
          </tr>
        </table>
      </div>
    </div>
    <div class="cliente" id='cargarpuntos'>
      <form class="contenedor" action="/sumar" method="post">
        <input style="height: 10%" type="number" name="monto" placeholder="Monto">
        <input style="height: 7%; margin: 5px" type="submit" id="enviarpuntos" value="Cargar">
        <input type="text" name="puntosactuales" id="puntosactuales">
        <input type="text" name="documentoactual" id="documentoactual">
      </form>
    </div>
    <div class='front' id='front'>
      <div class="botonesfront">
        <input class="botones2" type="button" id="registrar" value="Registrar usuario nuevo">
        <input class="botones2" type="button" id="eliminar" value="Eliminar cliente">
      </div>
      <div style="padding-top: 15%; text-align: center">DESLICE TARJETA PARA COMENZAR</div>
    </div>
  </body>
</html>

<script src="/jquery-3.4.1.min.js"></script>

<script src="http://localhost:4000/socket.io/socket.io.js"></script>

<script type="text/javascript">
  $('#cliente').hide();
  $('#cargarpuntos').hide();
  $('#registrar').click( function() {
    $("#body").load("./registrar");
  });
  $('#eliminar').click( function() {
    $("#body").load("./eliminar");
  });
  $('#cargar').click( function() {
    $("#body").load("./cargar");
  });

  $('#eliminarthis').click( function() {
    event.preventDefault();
    var newForm = jQuery('<form>', {
        'action': '/eliminar',
        'method': 'post'
    }).append(jQuery('<input>', {
        'name': 'documento',
        'value': $('#documento').html(),
        'type': 'hidden'
    }));
    $(document.body).append(newForm);
    newForm.submit();
  });
  $('#cargar').click( function() {
    var puntos = $('#puntos').val();
    var doc = $('#documento').val();
    $('#cargarpuntos').show('slow');
    $('#puntosactuales').val(puntos);
    $('#documentoactuales').val(doc);
    $('#cliente').hide('slow');
  });

  jQuery(function($){
    var socket = io.connect('http://localhost:4000');
    socket.on('rfid', function(rfidtag) {
      socket.emit('cargarcliente', rfidtag);
    });
    socket.on('datoscliente', function(cliente){
      yeet();
      $('#cliente').show('slow');
      $('#documento').html(cliente[0].documento);
      $('#tarjeta').html(cliente[0].tarjeta);
      $('#nacimiento').html(cliente[0].nacimiento.slice(0,10));
      $('#puntos').html(cliente[0].puntos);
    })
    socket.on('reload', function(a) {
      window.location.reload();
    })
  });

  function yeet() {
    $("#front").hide('slow');
  }
</script>
